<project name="findbugsTestCasesOS" default="build" xmlns:ivy="antlib:org.apache.ivy.ant">
  <target name="build"/>

  <!-- usage examples:
    ant build-revision -Drevision=3.0.0
    ant build-revision -Drevision=master
    ant build-revision -Drevision=d4c94995d235 
  -->
  <target name="build-revision" depends="export">
    <ant dir="fbexport/findbugs"/>
  </target>

  <!-- property testproject must be set 
    usage examples:
    ant retrieve -Dtestproject=commons-lang-2.0
  -->
  <target name="retrieve">
    <echo message="Retrieving '${testproject}'"/>
    <ivy:resolve file="projects/${testproject}/ivy.xml" conf="*" />
    <ivy:retrieve pattern="projects/${testproject}/[type]/[artifact]-[revision].[ext]" type="jar,source" conf="*" />
  </target>

  <target name="export">
    <property name="revision" value="master"/>
    <mkdir dir="fbexport"/>
    <delete>
        <fileset dir="fbexport" includes="**"/>
    </delete>
    <echo message="Exporting '${revision}' into fbexport"/>
    <exec executable="git" spawn="false" dir="..">
            <arg value="archive"/>
            <arg value="${revision}"/>
            <arg value="findbugs"/>
            <arg value="-o"/>
            <arg value="findbugsTestCasesOS/fbexport/fb.zip"/>
    </exec>
    <exec executable="unzip" dir="fbexport">
            <arg value="-q"/>
            <arg value="fb.zip"/>
    </exec>
    <delete file="fbexport/fb.zip"/>
  </target>

  <target name="clean">
    <delete includeemptydirs="true">
        <fileset dir="fbexport" includes="**"/>
    </delete>
  </target>
</project>