<project name="webUpdateServerCommon" default="fulljar">
	<path id="common.classpath">
		<path location="../../webCloudProtocol/build/webCloudProtocol.jar" />
		<path location="../webCommon/build/classes" />
		<fileset dir="lib" includes="*.jar" />
	</path>

	<target name="clean">
		<delete dir="build" />
	</target>

	<target name="compile">
		<ant dir="../../webCloudProtocol" target="fulljar" inheritall="false" />
		<ant dir="../webCommon" target="compile" inheritall="false" />
		<mkdir dir="build/classes" />
		<javac srcdir="src/java" destdir="build/classes" classpathref="common.classpath"
			debug="on" includeantruntime="false" source="1.7" target="1.7" />
	</target>

	<target name="compile-tests" depends="compile">
		<mkdir dir="build/classes-tests-ant" />
		<ant dir="../webCommon" target="compile-tests" inheritall="false" />
		<javac srcdir="src/junit" destdir="build/classes-tests-ant"
			debug="on" source="1.7" target="1.7" includeantruntime="false">
			<classpath>
				<path refid="common.classpath" />
				<path location="build/classes" />
			</classpath>
		</javac>
	</target>

	<target name="fulljar-check" depends="compile">
		<uptodate property="fulljar-not-necessary" targetfile="build/webUpdateServerCommon.jar">
			<srcfiles dir="build/classes" includes="**/*" />
			<srcfiles dir="lib" includes="**/*" />
			<srcfiles file="../../webCloudProtocol/build/webCloudProtocol.jar" />
		</uptodate>
	</target>

	<target name="fulljar" depends="fulljar-check" unless="fulljar-not-necessary">
		<mkdir dir="build" />
		<jar jarfile="build/webUpdateServerCommon.jar">
			<fileset dir="build/classes" />
			<fileset dir="../webCommon/build/classes" />

			<zipfileset src="../../webCloudProtocol/build/webCloudProtocol.jar" />

			<zipfileset src="lib/charts4j-1.3.jar" />
			<zipfileset src="lib/commons-fileupload-1.2.2.jar"/>
			<zipfileset src="lib/commons-lang-2.5.jar" />
			<zipfileset src="lib/dyuproject-openid-1.1.6.jar" />
			<zipfileset src="lib/dyuproject-util-1.1.6.jar" />
			<zipfileset src="lib/guava.jar" />
			<zipfileset src="lib/jdo2-api-2.3-eb.jar" />
			<zipfileset src="lib/jetty-util-6.1.19.jar" />
			<zipfileset src="lib/servlet-api-2.5-20081211.jar" />
		</jar>
	</target>
</project>

